<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Find Mentors - VCC</title>
    <link rel="stylesheet" href="/static/style.css" />
    <script src="/static/dark-mode.js" defer></script>
</head>
<body>
    <header class="topbar">
        <div class="brand">
            <img src="/static/images/logo.svg" alt="logo" class="logo" />
            <h1>Virtual Career Counselor</h1>
        </div>
        <nav class="nav">
            <a class="btn-soft" href="/">ğŸ  Home</a>
            <a class="btn-soft" href="/dashboard">ğŸ“Š Dashboard</a>
            <a class="btn-soft" href="/career-explore">ğŸ” Explore</a>
            <a class="btn-soft" href="/courses">ğŸ“š Courses</a>
            <a class="btn-soft" href="/job-insights">ğŸ’¼ Jobs</a>
            <a class="btn-soft" href="/profile">ğŸ‘¤ Profile</a>
            <a class="btn-soft" href="/resume-builder">ğŸ“„ Resume</a>
            <a class="btn-soft" href="/interview-prep">ğŸ¤ Interview</a>
            <a class="btn-soft" href="/career-match">ğŸ¯ Match</a>
            <a class="btn-soft" href="/analytics">ğŸ“Š Analytics</a>
            <a class="btn-soft" href="/saved-jobs">ğŸ”– Saved</a>
            <a class="btn-soft" href="/settings">âš™ï¸ Settings</a>
            <details class="nav-more">
                <summary class="btn-soft">âœ¨ More</summary>
                <div class="nav-more-menu">
                    <a class="btn-soft" href="/salary-negotiation">ğŸ’° Salary</a>
                    <a class="btn-soft" href="/company-insights">ğŸ¢ Companies</a>
                    <a class="btn-soft" href="/mentors">ğŸ‘¥ Mentors</a>
                    <a class="btn-soft" href="/forum">ğŸ’¬ Forum</a>
                    <a class="btn-soft" href="/learning-paths">ğŸ“š Paths</a>
                    <a class="btn-soft" href="/referrals">ğŸ¤ Refer</a>
                    <a class="btn-soft" href="/connections">ğŸ¤ Connections</a>
                    <a class="btn-soft" href="/leaderboard">ğŸ† Leaderboard</a>
                </div>
            </details>
            <a class="btn-soft" href="/logout">ğŸšª Logout</a>
        </nav>
    </header>

    <div class="container">
        <div class="card">
            <h2>ğŸ‘¥ Find Mentors</h2>
            <p>Connect with experienced professionals in your field</p>

            <div class="search-section">
                <input type="text" id="careerSearch" class="form-input-enhanced" placeholder="Search by career field (optional)" />
                <button class="btn-soft" id="searchMentors">ğŸ” Find Mentors</button>
            </div>

            <div id="mentorsList" class="mentors-list"></div>
        </div>
    </div>

    <script>
        async function loadMentors() {
            const career = document.getElementById('careerSearch').value.trim();
            const url = career ? `/api/mentors?career=${encodeURIComponent(career)}` : '/api/mentors';
            
            const res = await fetch(url);
            if (res.ok) {
                const data = await res.json();
                const mentors = data.mentors || [];
                const container = document.getElementById('mentorsList');
                
                if (mentors.length === 0) {
                    container.innerHTML = '<p class="muted">No mentors found. Try a different search term or check back later!</p>';
                } else {
                    container.innerHTML = mentors.map(m => {
                        const user = m.user || {};
                        const profile = user.profile || {};
                        return `
                            <div class="mentor-card">
                                <div class="mentor-header">
                                    <h3>${profile.fullName || profile.name || 'Mentor'}</h3>
                                    <div class="match-score">Match Score: ${m.matchScore || 0}</div>
                                </div>
                                <div class="mentor-details">
                                    <p><strong>Current Role:</strong> ${profile.currentRole || 'Not specified'}</p>
                                    <p><strong>Target Role:</strong> ${profile.targetRole || 'Not specified'}</p>
                                    <p><strong>Experience:</strong> ${m.completedActivities || 0} completed activities</p>
                                </div>
                                <div class="mentor-actions">
                                    <button class="btn-soft" onclick="sendConnectionRequest('${user.userId}', '${profile.fullName || 'Mentor'}')">
                                        ğŸ¤ Connect
                                    </button>
                                    <a href="/profile/${user.publicProfileId || user.userId}" class="btn-soft" target="_blank">
                                        ğŸ‘¤ View Profile
                                    </a>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }
        }

        window.sendConnectionRequest = async (userId, name) => {
            const message = prompt(`Send a connection request to ${name} (optional message):`);
            const res = await fetch('/api/connections/request', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({toUserId: userId, message: message || null})
            });

            if (res.ok) {
                alert('Connection request sent!');
            } else {
                alert('Failed to send request');
            }
        };

        document.getElementById('searchMentors').addEventListener('click', loadMentors);
        loadMentors(); // Load on page load
    </script>
</body>
</html>
